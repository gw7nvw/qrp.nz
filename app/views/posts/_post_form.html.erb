<script type="text/javascript">
//<![CDATA[
   bkLib.onDomLoaded(startEdit);

function startEdit() {
  nicEditors.allTextAreas();
  init();
}

</script>

<div class="fullform">
   <%= form_for(@post) do |f| %>
     <%=hidden_field_tag(:topic_id, @topic.id)%>
     <div id="actionbar-form" class="span12">
       <div id="crumbs">
         <%=link_to "Home", '/'%>
         &nbsp;--&gt;&nbsp;
         <%=  link_to  "Topics", '/topics'%>
         &nbsp;--&gt;&nbsp;
         <%if @topic%>
            <b><%=link_to @topic.name, '/topics/'+@topic.url%></b>
            &nbsp;--&gt;&nbsp;
         <% end %>
         <%if @post.id%>
            <b><%=link_to @post.title, '/posts/'+@post.id.to_s%></b>
            &nbsp;--&gt;&nbsp;
            <b>Edit</b>
         <% else %>
            <b>New</b>
         <% end %>

       </div>

       <div id="controls">
          <%= f.submit @submit_button, class: "btn btn-small btn-primary btn-highlight" %>
          <% if @post.id %><% if params[:referring]=='index'%>
            <%=  link_to "Cancel", '/posts', class: "btn btn-small btn-primary"%>
          <% else %>
            <%=  link_to "Cancel", '/posts/'+@post.id.to_s, class: "btn btn-small btn-primary"%>
          <% end %> <% end %>

          <%  if(@submit_button == "Save Changes" and (current_user.is_admin or current_user.id==@post.created_by_id)) %>
            <%= f.submit "Delete Post", confirm: "Delete post: Are you sure?", class: "btn btn-small btn-primary", id:  "deletebutton" %>
          <% end %>

       </div>
     </div>


     <div id="left_panel"  style="margin-top:0px !important">
        <%=render 'layouts/left_panel'%>
     </div>
     <div id="right_panel"  style="margin-top:0px !important">


       <%= render 'shared/error_messages' %>	

       <div id="right_scroll">
 
         <% if @topic.date_required %>
         <span>
           <%=@topic.name%> on/from:
           <%=   f.date_field :referenced_date %>
           <%=   f.time_field :referenced_time %>
         </span>
         <% end %>
         <% if @topic.duration_required %>
         <span>
           <%=@topic.name%> trip duration (days):
           <%=   f.text_field :duration %>
         </span>
         <% end %>

         <span>
           <%=f.label :title %>
           <%= f.text_field :title %>
         </span>
   
         <%=f.label :description%>
         <div id="editPanel"></div>
         <span id="descrSpan">
           <%= f.text_area :description %>
         </span>
   <%  if(@submit_button != "Save Changes" and current_user and current_user.is_admin) %>
         <div class="erow">
           <%=f.label "Check to supress emails of this post" %> 
           <%= f.check_box :do_not_publish %>
         </div>
   <% end %>
         <div id="attachments">
           <div class="erow"><div class="sectiontitle">Attachments:</div></div>
           <div class="erow" id="filename_form" style="display:none">
             <div class="sectiontitle25">Filename:</div>
               <%= f.file_field :image %>
             </div>
           </div>
           <div id="link_div">
             <u><i><a href="#" onclick="show_div('filename_form');hide_div('link_div');return(false);">Attach file</a></i></u>
           </div>
           <% if @post.files %>
             <% @post.files.each do |uf| %>
               <div class="erow">
                  <div class="hrline">
                     <hr noshade size="3">
                  </div>
               </div>
               File: <%= uf.image.url.split('/')[4].split('?')[0] %>
             <% end %>
           <% end %>

           <% if @post.images %>
              <% @post.images.each do |image| %>
                 <div class="erow">
                    <div class="hrline">
                      <hr noshade size="3">
                    </div>
                 </div>
              <%= link_to (image_tag image.image.url(:original), style: 'max-height:480px;max-width:480px'), image.image.url(:original), :target=>"_blank"%>
              <% end %>
           <% end %>

    
         </div>
       </div>
  <% end %>
</div>
<script>
  startEdit();
</script>

